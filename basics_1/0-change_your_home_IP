#!/usr/bin/env bash
# Rewrite /etc/hosts so that localhost resolves to 127.0.0.2 and facebook.com resolves to 8.8.8.8

tmp_file="$(mktemp)"

# Put the new localhost mapping first, keep other lines except old localhost/facebook.com,
# then add the facebook.com mapping at the end.
awk '
  BEGIN {
    print "127.0.0.2 localhost"
  }
  # keep every line that is not a localhost(127.0.0.1) or facebook.com entry
  !/^[[:space:]]*127\.0\.0\.1[[:space:]]+localhost(\b|[[:space:]])/ &&
  $0 !~ /(^|[[:space:]])facebook\.com([[:space:]]|$)/ {
    print
  }
  END {
    print "8.8.8.8 facebook.com"
  }
' /etc/hosts > "$tmp_file"

# Overwrite /etc/hosts contents without rename
cat "$tmp_file" > /etc/hosts
rm -f "$tmp_file"
